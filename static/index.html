<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Chat Bienestar</title>
<style>
body { font-family: Arial; background: #f3f3f3; padding: 20px; }
#chat { background: white; padding: 10px; height: 400px; overflow-y: scroll; border-radius: 8px; }
.msg-user { text-align: right; color: blue; margin: 5px 0; }
.msg-bot { text-align: left; color: green; margin: 5px 0; }
</style>
</head>
<body>

<h2>Chat Yo Soy Bienestar</h2>

<button onclick="nuevaSesion()">Nuevo chat</button>

<div id="chat"></div>

<br>
<input id="input" type="text" placeholder="Escribe..." style="width:80%">
<button onclick="enviar()">Enviar</button>

<script>
let session_id = null;

// Crear sesi칩n al iniciar
async function nuevaSesion() {
    const res = await fetch("http://localhost:8080/nueva_sesion");
    const data = await res.json();
    session_id = data.session_id;
    document.getElementById("chat").innerHTML =
        "<div class='msg-bot'><b>Chat reiniciado</b></div>";
}

async function enviar() {
    const texto = document.getElementById("input").value;
    if (!session_id) await nuevaSesion();  // crea sesi칩n si no existe

    document.getElementById("chat").innerHTML +=
        `<div class='msg-user'>${texto}</div>`;

    const res = await fetch("http://localhost:8080/mensajear", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ session_id, mensaje: texto })
    });

    const data = await res.json();
    document.getElementById("chat").innerHTML +=
        `<div class='msg-bot'>${data.respuesta}</div>`;

    document.getElementById("input").value = "";
    document.getElementById("chat").scrollTop = chat.scrollHeight;
}

// iniciar sesi칩n autom치tica
nuevaSesion();
</script>

</body>
</html>
